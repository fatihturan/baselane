name: Purge JSDeliver Cache

on:
  push:
    branches: [ main ]
    paths:
      - '**.js'
      - '**.css'

jobs:
  purge-cache:
    runs-on: ubuntu-latest
    steps:
      - name: Purge JSDeliver Cache
        run: |
          echo "üßπ Purging JSDeliver cache..."
          
          # Multiple files
          FILES=(
            "custom-lightbox.js"
            # Add more files here if needed
          )
          
          for file in "${FILES[@]}"; do
            echo "Purging: $file"
            curl -s "https://purge.jsdelivr.net/gh/${{ github.repository }}@main/$file"
            echo ""
            sleep 2
          done
          
          echo "‚úÖ All files purged!"
          echo "üîó Updated URL: https://cdn.jsdelivr.net/gh/${{ github.repository }}@main/custom-lightbox.js"

      - name: Verify cache purge
        run: |
          echo "‚è≥ Waiting 30 seconds for cache to update..."
          sleep 30
          
          echo "üîç Checking if cache is updated..."
          RESPONSE=$(curl -s -I "https://cdn.jsdelivr.net/gh/${{ github.repository }}@main/custom-lightbox.js")
          echo "Response headers:"
          echo "$RESPONSE"